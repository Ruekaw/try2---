# MCM 2026 Problem C - Q1 ç»Ÿä¸€MCMCç²‰ä¸æŠ•ç¥¨åæ¨æ¨¡å‹ æ€è·¯æ€»ç»“

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

**ç›®æ ‡ä»»åŠ¡**ï¼šåæ¨DWTSï¼ˆä¸æ˜Ÿå…±èˆï¼‰èŠ‚ç›®ä¸­æœªå…¬å¼€çš„ç²‰ä¸æŠ•ç¥¨åˆ†å¸ƒ

**æ ¸å¿ƒæŒ‘æˆ˜**ï¼š
1. ç²‰ä¸æŠ•ç¥¨æ•°æ®å®Œå…¨æœªçŸ¥ï¼ŒåªçŸ¥é“æ·˜æ±°ç»“æœ
2. ä¸åŒèµ›å­£ä½¿ç”¨ä¸åŒçš„è¯„åˆ†è§„åˆ™ï¼ˆç™¾åˆ†æ¯”åˆ¶/æ’ååˆ¶ï¼‰
3. éœ€è¦é‡åŒ–ä¼°è®¡çš„ä¸ç¡®å®šæ€§å’Œä¸€è‡´æ€§

---

## ğŸ¯ æ ¸å¿ƒæ€æƒ³

### ç»Ÿä¸€æ¡†æ¶è®¾è®¡

**å…³é”®**ï¼šä¸åŒºåˆ†ç™¾åˆ†æ¯”åˆ¶/æ’ååˆ¶ï¼Œç»Ÿä¸€åœ¨**æŠ•ç¥¨ä»½é¢ç©ºé—´**ä¸Šè¿›è¡Œè´å¶æ–¯æ¨æ–­

- **çŠ¶æ€ç©ºé—´**ï¼šå•çº¯å½¢ $\Delta^{n-1} = \{v \in \mathbb{R}^n : \sum_{i=1}^n v_i = 1, v_i \geq 0\}$
- **è§‚æµ‹æ•°æ®**ï¼šæ·˜æ±°ç»“æœï¼ˆå“ªäº›é€‰æ‰‹è¢«æ·˜æ±°ï¼‰+ è¯„å§”åˆ†æ•°ï¼ˆå·²çŸ¥ï¼‰
- **æ¨æ–­ç›®æ ‡**ï¼šç²‰ä¸æŠ•ç¥¨ä»½é¢å‘é‡ $v = (v_1, v_2, \ldots, v_n)$

---

## ğŸ“ æ•°å­¦æ¨¡å‹

### 1. åéªŒåˆ†å¸ƒ

**ç›®æ ‡åˆ†å¸ƒ**ï¼ˆæœªå½’ä¸€åŒ–çš„åéªŒï¼‰ï¼š

$$
P(v \mid \text{æ·˜æ±°ç»“æœ}) \propto \text{prior}(v) \times \mathbb{I}(v \text{ æ»¡è¶³æ·˜æ±°çº¦æŸ})
$$

å…¶ä¸­ï¼š
- **å…ˆéªŒåˆ†å¸ƒ**ï¼š$\text{prior}(v) = \text{Dirichlet}(\alpha, \alpha, \ldots, \alpha)$
  - é»˜è®¤ $\alpha = 1.0$ï¼ˆå‡åŒ€å…ˆéªŒï¼Œæœ€å¤§ç†µï¼Œæ— åå¥½ï¼‰
  - $\alpha > 1$ï¼šåå¥½å‡åŒ€åˆ†å¸ƒçš„æŠ•ç¥¨
  - $\alpha < 1$ï¼šåå¥½æç«¯åˆ†å¸ƒï¼ˆç¨€ç–æŠ•ç¥¨ï¼‰

- **æ·˜æ±°çº¦æŸ**ï¼š$\mathbb{I}(\cdot)$ ä¸ºæŒ‡ç¤ºå‡½æ•°
  - **ç™¾åˆ†æ¯”åˆ¶**ï¼šè¢«æ·˜æ±°è€…å¿…é¡»åœ¨ç»¼åˆç™¾åˆ†æ¯”çš„ bottom-k ä¸­ï¼ˆå¾—åˆ†æœ€ä½çš„käººï¼‰
  - **æ’ååˆ¶**ï¼šè¢«æ·˜æ±°è€…å¿…é¡»åœ¨æ’åå’Œçš„ top-k ä¸­ï¼ˆæ’åå’Œæœ€å¤§çš„käººï¼‰

### 2. ç»¼åˆå¾—åˆ†è®¡ç®—

#### ç™¾åˆ†æ¯”åˆ¶ï¼ˆS1-S27ï¼‰

$$
\text{ç»¼åˆç™¾åˆ†æ¯”}_i = \text{è¯„å§”ç™¾åˆ†æ¯”}_i + \text{ç²‰ä¸æŠ•ç¥¨ç™¾åˆ†æ¯”}_i
$$

å…¶ä¸­ï¼š
- è¯„å§”ç™¾åˆ†æ¯”ï¼š$\text{Judge}_i^\% = \frac{\text{Judge}_i}{\sum_j \text{Judge}_j}$
- ç²‰ä¸æŠ•ç¥¨ç™¾åˆ†æ¯”ï¼š$v_i$ï¼ˆå¾…ä¼°è®¡ï¼‰
- **æ·˜æ±°è§„åˆ™**ï¼šç»¼åˆç™¾åˆ†æ¯”æœ€ä½çš„ $k$ äººè¢«æ·˜æ±°

#### æ’ååˆ¶ï¼ˆS28+ï¼‰

$$
\text{ç»¼åˆæ’åå’Œ}_i = \text{ç²‰ä¸æŠ•ç¥¨æ’å}_i + \text{è¯„å§”åˆ†æ•°æ’å}_i
$$

å…¶ä¸­ï¼š
- æ’åä½¿ç”¨ `rankdata(-score, method='min')`ï¼ˆåˆ†æ•°é«˜â†’æ’åä½ï¼‰
- **æ·˜æ±°è§„åˆ™**ï¼šæ’åå’Œæœ€å¤§çš„ $k$ äººè¢«æ·˜æ±°

### 3. ç‰¹æ®Šæœºåˆ¶ï¼šè¯„å§”æ•‘äººï¼ˆS28+ï¼‰

- èŠ‚ç›®å…ˆç¡®å®šç»¼åˆå¾—åˆ†çš„ **bottom-2**
- è¯„å§”åœ¨ bottom-2 ä¸­é€‰æ‹©æ·˜æ±°ä¸€äºº
- **å»ºæ¨¡å¤„ç†**ï¼šå…è®¸è¢«æ·˜æ±°è€…å±äº bottom-2ï¼ˆè€Œéå¿…é¡»æ˜¯ç»å¯¹å«åº•ï¼‰

### 4ã€å†³èµ›å‘¨ç‰¹æ®Šå¤„ç†çº¦æŸï¼š
ä½ éœ€è¦æ”¹ä¸ºé“¾å¼æ¯”è¾ƒé€»è¾‘ï¼ˆæˆ‘å·²ç»åœ¨æ¸…æ´—åçš„æ•°æ®ä¸­æ ‡æ˜äº†å†³èµ›å‘¨final_weekå’Œå†³èµ›å‘¨æœ‰å‡ ä¸ªäººæœ‰åˆ†æ•°final_week_n_performersï¼Œç›´æ¥ç”¨å°±è¡Œï¼‰ï¼š
ç›®æ ‡ï¼šç¬¬1å > ç¬¬2å > ç¬¬3å ...
è¾“å…¥ï¼šå†³èµ›é€‰æ‰‹çš„æœ€ç»ˆåæ¬¡åˆ—è¡¨ï¼Œä¾‹å¦‚ $[P_A, P_B, P_C]$ åˆ†åˆ«å¯¹åº” 1st, 2nd, 3rdã€‚
è¿çº¦è®¡ç®—ï¼š
$$V = \max(0, S_{P_2} - S_{P_1}) + \max(0, S_{P_3} - S_{P_2}) + \dots$$
(æ³¨ï¼šæ„æ€æ˜¯ï¼Œå¦‚æœç¬¬2åå¾—åˆ†æ¯”ç¬¬1åé«˜ï¼Œå°±ç½šï¼›å¦‚æœç¬¬3åæ¯”ç¬¬2åé«˜ï¼Œä¹Ÿç½šã€‚ç´¯åŠ æ‰€æœ‰â€œé€†åºâ€çš„ç¨‹åº¦)

åœ¨å†™ä»£ç æ—¶ï¼Œåƒä¸‡å°å¿ƒä¸åŒèµ›å­£çš„â€œå¥½åâ€å®šä¹‰æ˜¯ç›¸åçš„ï¼š
ç™¾åˆ†æ¯”åˆ¶ (Season 3-27)ï¼š
è§„åˆ™ï¼šåˆ†æ•°ï¼ˆ%ï¼‰è¶Šé«˜è¶Šå¥½ã€‚
å†³èµ›çº¦æŸï¼š$Total\%(\text{1st}) > Total\%(\text{2nd}) > Total\%(\text{3rd})$
è¿çº¦é¡¹ï¼š$\max(0, Total\%(\text{lower\_rank}) - Total\%(\text{higher\_rank}))$
æ’ååˆ¶ (Season 1-2, 28+)ï¼š
è§„åˆ™ï¼šæ’åå’Œï¼ˆSum of Ranksï¼‰è¶Šå°è¶Šå¥½ ã€‚
å†³èµ›çº¦æŸï¼š$SumRank(\text{1st}) < SumRank(\text{2nd}) < SumRank(\text{3rd})$
è¿çº¦é¡¹ï¼š$\max(0, SumRank(\text{higher\_rank}) - SumRank(\text{lower\_rank}))$
è§£é‡Šï¼šå¦‚æœå† å†›çš„æ’åå’Œï¼ˆæ¯”å¦‚3ï¼‰ç«Ÿç„¶æ¯”äºšå†›çš„æ’åå’Œï¼ˆæ¯”å¦‚2ï¼‰è¿˜è¦å¤§ï¼Œè¿™å°±æ˜¯è¿çº¦ã€‚




---

## ğŸ”¬ MCMCé‡‡æ ·æ–¹æ³•

### Metropolis-Hastings ç®—æ³•

**æ ¸å¿ƒæµç¨‹**ï¼š

1. **åˆå§‹åŒ–**ï¼šéšæœºæœç´¢æ»¡è¶³çº¦æŸçš„åˆå§‹çŠ¶æ€ $v^{(0)}$

2. **è¿­ä»£é‡‡æ ·**ï¼ˆç¬¬ $t$ æ­¥ï¼‰ï¼š
   
   a) **æè®®æ–°çŠ¶æ€**ï¼š
   $$
   v' \sim \text{Dirichlet}(\kappa \cdot v^{(t)})
   $$
   å…¶ä¸­ $\kappa$ ä¸ºæµ“åº¦ç¼©æ”¾å‚æ•°ï¼ˆ`proposal_scale`ï¼‰
   
   b) **è®¡ç®—æ¥å—æ¦‚ç‡**ï¼š
   $$
   \alpha(v' | v^{(t)}) = \min\left(1, \frac{\pi(v') \cdot q(v^{(t)} | v')}{\pi(v^{(t)}) \cdot q(v' | v^{(t)})}\right)
   $$
   
   c) **æ¥å—/æ‹’ç»**ï¼š
   - ä»¥æ¦‚ç‡ $\alpha$ æ¥å—ï¼š$v^{(t+1)} = v'$
   - å¦åˆ™ä¿æŒï¼š$v^{(t+1)} = v^{(t)}$

3. **é¢„çƒ­æœŸ**ï¼ˆBurn-inï¼‰ï¼šä¸¢å¼ƒå‰ `burn_in` ä¸ªæ ·æœ¬

4. **ç¨€ç–é‡‡æ ·**ï¼ˆThinningï¼‰ï¼šæ¯ `thin` ä¸ªæ ·æœ¬ä¿ç•™1ä¸ªï¼ˆå‡å°‘è‡ªç›¸å…³ï¼‰

#### è½¯çº¦æŸæ¨¡å¼
- åéªŒï¼š$\log \pi(v) = \log \text{prior}(v) - \lambda \cdot V(v)$
- è¿çº¦å‡½æ•°ï¼š
  $$
  V(v) = \sum_{e \in \text{è¢«æ·˜æ±°è€…}} \max(0, \text{è¿çº¦ç¨‹åº¦}_e)
  $$

---

## ğŸ“Š é‡åŒ–æŒ‡æ ‡


### 1. ç¡®å®šæ€§åº¦é‡ï¼ˆCertaintyï¼‰-é€šè¿‡MCMCå¾—åˆ°

1. ç¬¦å·å®šä¹‰ (Notation)
è®¾ $V_{i,t}$ ä¸ºç¬¬ $t$ å‘¨ç¬¬ $i$ ä½é€‰æ‰‹çš„çœŸå®ç²‰ä¸ç¥¨æ•°ï¼ˆæˆ–å¾—ç¥¨æ¯”ä¾‹ï¼‰ã€‚
é€šè¿‡ MCMC ç®—æ³•ï¼Œå¯¹äºæ¯ä¸€ä¸ª $(i, t)$ï¼Œæˆ‘ä»¬ç”Ÿæˆäº† $N$ ä¸ªåéªŒé‡‡æ ·ç‚¹ï¼š

$$\{v_{i,t}^{(1)}, v_{i,t}^{(2)}, \dots, v_{i,t}^{(N)}\}$$
2. åŸºç¡€ç»Ÿè®¡é‡è®¡ç®— (Basic Statistics)
é¦–å…ˆè®¡ç®—åéªŒåˆ†å¸ƒçš„å‡å€¼ï¼ˆMeanï¼‰å’Œæ ‡å‡†å·®ï¼ˆStandard Deviationï¼‰ï¼š

$$\mu_{i,t} = \frac{1}{N} \sum_{k=1}^{N} v_{i,t}^{(k)}$$

$$\sigma_{i,t} = \sqrt{\frac{1}{N-1} \sum_{k=1}^{N} \left(v_{i,t}^{(k)} - \mu_{i,t}\right)^2}$$
3. ç¡®å®šæ€§åº¦é‡å…¬å¼ (Certainty Metrics)
æˆ‘ä»¬å°†ç¡®å®šæ€§åˆ†ä¸ºä¸¤éƒ¨åˆ†å®šä¹‰ï¼š
æŒ‡æ ‡ Aï¼šç›¸å¯¹ç¡®å®šæ€§æŒ‡æ•° (Relative Certainty Index, $\lambda$)
ç”¨é€”ï¼šç”¨äºå½’ä¸€åŒ–æ¯”è¾ƒï¼Œå›ç­”â€œä¸åŒé€‰æ‰‹/å‘¨æ¬¡çš„ç¡®å®šæ€§æ˜¯å¦ç›¸åŒâ€ã€‚è¯¥æŒ‡æ ‡å€¼åœ¨ $(0, 1]$ ä¹‹é—´ï¼Œè¶Šæ¥è¿‘ 1 è¡¨ç¤ºè¶Šç¡®å®šã€‚
æˆ‘ä»¬é¦–å…ˆå®šä¹‰å˜å¼‚ç³»æ•° (Coefficient of Variation, CV) ä¸ºä¸ç¡®å®šæ€§çš„åŸå§‹åº¦é‡ï¼š

$$CV_{i,t} = \frac{\sigma_{i,t}}{\mu_{i,t}}$$
ç„¶åï¼Œå®šä¹‰ç¡®å®šæ€§æŒ‡æ•° (Certainty Index) $\lambda_{i,t}$ å¦‚ä¸‹ï¼š

$$\lambda_{i,t} = \frac{1}{1 + CV_{i,t}} = \frac{\mu_{i,t}}{\mu_{i,t} + \sigma_{i,t}}$$
ç‰©ç†æ„ä¹‰ï¼š
å½“ $\sigma_{i,t} \to 0$ (æå…¶ç²¾å‡†) æ—¶ï¼Œ$\lambda_{i,t} \to 1$ã€‚
å½“ $\sigma_{i,t}$ å¾ˆå¤§ (æå…¶æ··ä¹±) æ—¶ï¼Œ$\lambda_{i,t} \to 0$ã€‚
è¯¥å…¬å¼å…·æœ‰è‰¯å¥½çš„å•è°ƒæ€§å’Œæœ‰ç•Œæ€§ï¼Œéå¸¸é€‚åˆç»˜åˆ¶çƒ­åŠ›å›¾ã€‚
æŒ‡æ ‡ Bï¼šç»å¯¹ç¡®å®šæ€§åŒºé—´ (Absolute Certainty Interval, $\Delta$)
ç”¨é€”ï¼šç”¨äºå±•ç¤ºå®é™…çš„ç¥¨æ•°æ³¢åŠ¨èŒƒå›´ï¼Œå›ç­”â€œç²‰ä¸ç¥¨æ•°ç©¶ç«Ÿæ˜¯å¤šå°‘â€ã€‚
å®šä¹‰ 95% è´å¶æ–¯å¯ä¿¡åŒºé—´ (Credible Interval)ï¼š

$$CI_{i,t}^{95\%} = [Q_{2.5}(v_{i,t}), \quad Q_{97.5}(v_{i,t})]$$
å…¶ä¸­ $Q_q(\cdot)$ è¡¨ç¤ºé‡‡æ ·åºåˆ—çš„ç¬¬ $q$ ç™¾åˆ†ä½æ•°ã€‚
å®šä¹‰åŒºé—´çš„ç»å¯¹å®½åº¦ (Absolute Width) ä¸ºï¼š

$$\Delta_{i,t} = Q_{97.5}(v_{i,t}) - Q_{2.5}(v_{i,t})$$


### 2. ä¸€è‡´æ€§åº¦é‡ï¼ˆConsistencyï¼‰-é€šè¿‡è½¯çº¦æŸè‡ªç„¶å¾—åˆ°

**åéªŒé¢„æµ‹æ£€éªŒï¼ˆPPCï¼‰**ï¼š

$$
\text{Consistency}_{\text{PPC}} = \frac{1}{S} \sum_{s=1}^S \mathbb{I}(v^{(s)} \text{ æ»¡è¶³æ·˜æ±°çº¦æŸ})
$$

**è¿çº¦åº¦ç»Ÿè®¡**ï¼š
- å‡å€¼è¿çº¦ï¼š$\overline{V}$


---

## ğŸ” MCMC è¯Šæ–­

### 1. æœ‰æ•ˆæ ·æœ¬é‡ï¼ˆESSï¼‰

ä½¿ç”¨ **Geyer åˆå§‹æ­£åºåˆ—ä¼°è®¡å™¨**ï¼š

$$
\text{ESS}_i = \frac{S}{\tau_i}
$$

å…¶ä¸­ $\tau_i = 1 + 2\sum_{k=1}^K \rho_k$ ä¸ºè‡ªç›¸å…³æ—¶é—´

**è§£é‡Š**ï¼š
- ESS æ¥è¿‘ $S$ â†’ æ ·æœ¬ç‹¬ç«‹æ€§å¥½
- ESS è¿œå°äº $S$ â†’ è‡ªç›¸å…³ä¸¥é‡ï¼Œéœ€å¢åŠ ç¨€ç–é—´éš”

### 2. è’™ç‰¹å¡æ´›æ ‡å‡†è¯¯ï¼ˆMCSEï¼‰

$$
\text{MCSE}_i = \frac{\sigma_i}{\sqrt{\text{ESS}_i}}
$$

**è§£é‡Š**ï¼šç”±äºæœ‰é™æ ·æœ¬å¯¼è‡´çš„ä¼°è®¡è¯¯å·®

### 3. æ¥å—ç‡ï¼ˆAcceptance Rateï¼‰

$$
\text{Acceptance Rate} = \frac{\# \text{ accepted proposals}}{\# \text{ total iterations}}
$$

---

## ğŸ—ï¸ ç¨‹åºæ¶æ„

### 1. é…ç½®æ¨¡å—ï¼ˆ`MCMCConfig`ï¼‰

**å…³é”®å‚æ•°**ï¼š

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `n_samples` | 5000 | ä¿ç•™çš„æœ‰æ•ˆæ ·æœ¬æ•° |
| `burn_in` | 2000 | é¢„çƒ­æœŸæ ·æœ¬æ•°ï¼ˆæ ·æœ¬å°†ä¸¢å¼ƒï¼‰ |
| `thin` | 2 | ç¨€ç–é‡‡æ ·é—´éš” |
| `proposal_scale` | 100.0 | Dirichlet æè®®æµ“åº¦ç¼©æ”¾ |
| `prior_alpha` | 1.0 | Dirichlet å…ˆéªŒæµ“åº¦ |
| `soft_elimination` | True | æ˜¯å¦ä½¿ç”¨è½¯çº¦æŸ |
| `violation_lambda` | 50.0 | è½¯çº¦æŸæƒ©ç½šå¼ºåº¦ |
| `ppc_threshold` | 0.95 | PPC ä¸€è‡´æ€§é˜ˆå€¼ |

### 2. é‡‡æ ·å™¨ï¼ˆ`UnifiedMCMCSampler`ï¼‰

**æ ¸å¿ƒæ–¹æ³•**ï¼š

```python
# è®¡ç®—ç»¼åˆå¾—åˆ†
_compute_total_scores(fan_votes, judge_scores, combine_method)

# æ£€æŸ¥æ·˜æ±°çº¦æŸ
_is_valid_elimination(fan_votes, judge_scores, eliminated_indices, ...)

# è®¡ç®—è¿çº¦ç¨‹åº¦ï¼ˆè½¯çº¦æŸï¼‰
_elimination_violation(fan_votes, judge_scores, eliminated_indices, ...)

# è®¡ç®—å¯¹æ•°åéªŒ
_log_posterior(fan_votes, judge_scores, eliminated_indices, ...)

# M-H æè®®
_propose(current)

# M-H æ¥å—æ¦‚ç‡
_log_proposal(v_to, v_from)

# ä¸»é‡‡æ ·å‡½æ•°
sample(judge_scores, eliminated_indices, combine_method, ...)
```

### 3. ä¸»æ§åˆ¶å™¨ï¼ˆ`UnifiedFanVoteInferenceEngine`ï¼‰

**å·¥ä½œæµç¨‹**ï¼š

1. **æ•°æ®åŠ è½½**ï¼šè¯»å–é¢„å¤„ç†åçš„ `dwts_long_clean.csv`
2. **é€å‘¨å¤„ç†**ï¼š
   - ç­›é€‰æœ¬å‘¨å‚èµ›é€‰æ‰‹
   - è¯†åˆ«è¢«æ·˜æ±°é€‰æ‰‹
   - è°ƒç”¨ MCMC é‡‡æ ·å™¨
   - æ±‡æ€»ç»“æœ
3. **å¹¶è¡ŒåŠ é€Ÿ**ï¼šæ”¯æŒèµ›å­£çº§åˆ«å¹¶è¡Œ
4. **ç»“æœå¯¼å‡º**ï¼š
   - å®½æ ¼å¼ï¼š`q1_fan_vote_mcmc_unified.csv`
   - é•¿æ ¼å¼ï¼š`q1_fan_vote_mcmc_unified_long.csv`

